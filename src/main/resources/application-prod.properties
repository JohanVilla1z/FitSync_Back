# ==========================================
# Overrides para el Perfil de Producción ('prod')
# ==========================================

# ==========================================
# Configuración de Logging (Producción)
# ==========================================
# Menos verboso en producción, ajustar según necesidad
logging.level.root=WARN
logging.level.com.johan.gym_control=INFO # INFO para ver flujo general, DEBUG si se necesita investigar
logging.level.org.hibernate.SQL=WARN
logging.level.org.hibernate.type.descriptor.sql=WARN

# ==========================================
# Configuración Base de Datos (Producción - HikariCP)
# ==========================================
# Usar variables de entorno para URL, user, password (ya configurado en application.properties)

# Configuración HikariCP Optimizada para Producción (Railway 500MB RAM)
spring.datasource.hikari.poolName=HikariPool-Prod
# Aumentar timeout de inicialización CRÍTICO!
spring.datasource.hikari.initializationFailTimeout=60000 # 60 segundos
# Reducir tamaño del pool para poca memoria
spring.datasource.hikari.maximumPoolSize=5
spring.datasource.hikari.minimumIdle=2
# Timeout de conexión general (puede ser un poco más alto)
spring.datasource.hikari.connectionTimeout=45000 # 45 segundos
# Tiempos de idle/lifetime (ajustar si es necesario, los defaults o los de application.properties pueden estar bien)
# spring.datasource.hikari.idleTimeout=300000
# spring.datasource.hikari.maxLifetime=1200000

# ==========================================
# Configuración JPA / Hibernate (Producción)
# ==========================================
# Más seguro para producción, asume que las migraciones se manejan externamente (Flyway/Liquibase) o manualmente
# Cambiar a 'validate' si quieres que Hibernate verifique el esquema contra las entidades
spring.jpa.hibernate.ddl-auto=validate # O 'none' si no quieres ninguna acción
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false

# Habilitar caché L2 en producción (Asegúrate de tener ehcache.xml configurado!)
spring.jpa.properties.hibernate.cache.use_second_level_cache=true
spring.jpa.properties.hibernate.cache.use_query_cache=true # Habilitar si usas caché de consultas
spring.jpa.properties.hibernate.cache.region.factory_class=org.hibernate.cache.jcache.JCacheRegionFactory
spring.jpa.properties.hibernate.javax.cache.provider=org.ehcache.jsr107.EhcacheCachingProvider
spring.jpa.properties.hibernate.javax.cache.uri=classpath:ehcache.xml # Asegúrate que este archivo exista y esté configurado

# Optimizaciones de rendimiento (mantener si funcionan bien)
spring.jpa.properties.hibernate.generate_statistics=false
spring.jpa.properties.hibernate.jdbc.batch_size=20 # Ajustar tamaño de batch según pruebas
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.batch_versioned_data=true

# Deshabilitar inicialización SQL en producción
spring.sql.init.mode=never

# ==========================================
# Configuración de Seguridad (Producción)
# ==========================================
# Asegurar cookies de sesión (importante si se usaran)
server.servlet.session.cookie.secure=true
server.servlet.session.cookie.same-site=Strict # Más seguro para prod

# Configuración de cabeceras Forwarded para proxies inversos (Railway/Render)
server.forward-headers-strategy=NATIVE # Usar NATIVE o FRAMEWORK según la plataforma
server.tomcat.remoteip.remote-ip-header=x-forwarded-for
server.tomcat.remoteip.protocol-header=x-forwarded-proto

# ==========================================
# Configuración CORS (Producción)
# ==========================================
# Los valores se toman de las variables de entorno definidas en application.properties
# Asegúrate que la variable ALLOWED_ORIGINS esté definida en Railway con 'https://fitsyncapp.netlify.app'
# spring.mvc.cors.allowed-origins=${ALLOWED_ORIGINS} # Ya definido en application.properties
spring.mvc.cors.allowed-headers=Authorization,Content-Type,X-Requested-With,Accept,Origin # Ser más específico que '*'
spring.mvc.cors.max-age=3600 # 1 hora

# ==========================================
# Configuración OpenAPI/Swagger (Deshabilitado en Prod)
# ==========================================
springdoc.api-docs.enabled=${ENABLE_API_DOCS:false} # Deshabilitado por defecto
springdoc.swagger-ui.enabled=${ENABLE_SWAGGER_UI:false} # Deshabilitado por defecto
